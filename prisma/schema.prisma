generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model ChatMessage {
  id                String        @id @default(cuid())
  conversationId    String
  tenantId          String
  timestamp         DateTime
  role              Role
  message           String        @db.Text
  responseTimeMs    Int?
  resolved          Boolean?
  satisfactionScore Float?
  createdAt         DateTime      @default(now())
  conversation      Conversation  @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  @@index([conversationId])
  @@index([tenantId])
  @@index([timestamp])
}

model Conversation {
  id               String        @id @default(cuid())
  conversationId   String        @unique
  tenantId         String
  startTime        DateTime
  endTime          DateTime?
  messageCount     Int           @default(0)
  resolved         Boolean       @default(false)
  satisfactionScore Float?
  duration         Int?          // Duration in seconds
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
  messages         ChatMessage[]

  @@index([tenantId])
  @@index([startTime])
}

model KPISnapshot {
  id                      String   @id @default(cuid())
  startDate               DateTime
  endDate                 DateTime
  // Response Metrics
  avgResponseTimeMs       Float?
  avgMessageLength        Float?
  avgResponseQuality      Float?
  // Conversation Metrics
  resolutionRate          Float?
  avgSatisfaction         Float?
  avgConversationDuration Float?
  // Usage Metrics
  totalConversations      Int
  totalMessages           Int
  activeTenants           Int
  messagesPerDay          Float?
  // AI Accuracy Metrics
  avgTurnsToResolution    Float?
  // Metadata
  createdAt               DateTime @default(now())

  @@unique([startDate, endDate])
  @@index([startDate])
  @@index([endDate])
}

model UploadHistory {
  id            String   @id @default(cuid())
  filename      String
  fileSize      Int
  recordsCount  Int
  uploadedAt    DateTime @default(now())
  status        UploadStatus
  errorMessage  String?  @db.Text
}

enum Role {
  AI
  TENANT
}

enum UploadStatus {
  SUCCESS
  FAILED
  PROCESSING
}
